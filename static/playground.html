<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>PlayGround</title>
    <style type="text/css">
html {
  scroll-behavior: smooth;
}
body {
  display: -ms-flexbox;
  display: flex;
  flex-direction: column !important;
  -ms-flex-align: center;
  align-items: center;
  background-color: #f5f5f5;
}
#player-container {
  margin: 0 auto;
  width: 100%;
  background-color: #000;
}
#player-content {
  padding-top: 56.25%;
  position: relative;
  width: 100%;
}
#player-content iframe {
  height: 100% !important;
  left: 0;
  position: absolute;
  top: 0;
  width: 100% !important;
}
#sub-container {
  margin: 20px auto;
  width: calc(100% - 5em);
}
#url-button {
  cursor: pointer;
}
#url-input {
  width: calc(100% - 7em);
  margin: 0 1em;
}
#form-container {
  margin: 20px auto;
  width: 60vw;
  display: flex;
  margin-top: 20px;
  flex-direction: row;
  justify-content: center;
}
    </style>
  </head>
  <body>
    <div id="player-container">
      <div id="player-content" >
        <div id="ytplayer"></div>
      </div>
    </div>
    <div id="form-container">
      <input id="url-input" type="text" class="form-control" autocomplete="on">
      <div id="url-button" class="btn btn-primary" onclick="Go();">
        Go
      </div>
    </div>
    <div id="sub-container">
      <div id="message-container">
        <div id="message">
        </div>
      </div>
    </div>
    <script>
    var player;
    var addUrlList = function(url) {
      var urlList = getUrlList();
      urlList.push(url);
      setUrlList(urlList);
      appendMessage([url]);
    };
    var getNextUrl = function() {
      var nextUrl = "";
      var urlList = getUrlList();
      if (urlList.length > 0) {
        nextUrl = urlList[0];
        urlList.shift();
        setUrlList(urlList);
      }
      return nextUrl;
    };
    var getUrlList = function() {
      var urlList = [];
      var jsonString = localStorage.getItem("urlList");
      if (!!jsonString && jsonString.length > 0) {
        urlList = JSON.parse(jsonString);
      }
      return urlList;
    };
    var setUrlList = function(urlList) {
      localStorage.setItem('urlList', JSON.stringify(urlList));
    };
    var refreshMessage = function() {
      clearMessage();
      appendMessage(getUrlList());
    };
    var clearMessage = function() {
      document.getElementById("message").innerHTML = '';
    };
    var appendMessage = function(urlList) {
      var messageElement = document.getElementById("message");
      urlList.forEach(v => {
        var p = document.createElement("p");
        var a = document.createElement("a");
        a.textContent = v;
        a.href = "#";
        a.onclick = "refreshPlayer(v);return false;";
        p.append(a);
        messageElement.append(p);
      });
    };
    var autoPlay = function() {
      if (!!player && !!player.getPlayerState && player.getPlayerState() == -1) {
        player.playVideo();
      }
      setTimeout(function() {
        autoPlay();
      }, 1000);
    };
    var Go = function() {
      var urlInput = document.getElementById("url-input");
      addUrlList(urlInput.value);
      urlInput.value = "";
      if (!!player && !!player.getPlayerState && player.getPlayerState() == 1) {
        console.log('Add url list. This url will play later.');
      } else {
        location.reload();
      }
    };
    function initPlayer(videoId) {
      player = new YT.Player('ytplayer', {
        height: '360',
        width: '640',
        videoId: videoId,
        playerVars: {
          'autoplay': 1,
        },
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange,
        }
      });
    }
    function onPlayerReady(event) {
      event.target.playVideo();
    }
    function onPlayerStateChange(event) {
      var ytStatus = event.data;
      if (ytStatus == YT.PlayerState.ENDED) {
        refreshPlayer(getNextUrl());
      }
    }
    function refreshPlayer(nextUrl) {
      if (nextUrl.length > 0) {
        var videoId = nextUrl.substring(32).split('&')[0];
        var contentElement = document.getElementById("player-content");
        contentElement.innerHTML = '';
        var divElement = document.createElement("div");
        divElement.id = 'ytplayer';
        contentElement.append(divElement);
        player = null;
        initPlayer(videoId);
        refreshMessage();
      }
    }
    if (getUrlList().length > 0) {
      var videoId = getNextUrl().substring(32).split('&')[0];
      var tag = document.createElement('script');
      tag.src = "https://www.youtube.com/player_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
      refreshMessage();
      function onYouTubePlayerAPIReady() {
        initPlayer(videoId);
      }
    }
    </script>
  </body>
</html>
