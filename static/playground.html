<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>PlayGround</title>
    <style type="text/css">
html {
  scroll-behavior: smooth;
}
body {
  display: -ms-flexbox;
  display: flex;
  flex-direction: column !important;
  -ms-flex-align: center;
  align-items: center;
  background-color: #f5f5f5;
  overflow-y: hidden;
}
#player-container {
  margin: 0 auto;
  width: 100%;
  background-color: #000;
}
#player-content {
  padding-top: 56.25%;
  position: relative;
  width: 100%;
}
#player-content iframe {
  height: 100% !important;
  left: 0;
  position: absolute;
  top: 0;
  width: 100% !important;
}
#sub-container {
  margin: 20px auto;
  width: calc(100% - 5em);
}
#message {
  max-height: calc(100vh - 55vw - 110px);
  overflow-y: scroll;
  -webkit-flex-wrap: wrap;
  -ms-flex-wrap: wrap;
  flex-wrap: wrap;
  display: flex;
}
#message > div {
  position: relative;
  width: 135px;
  height: 105px;
  margin: 5px;
  cursor: pointer;
}
#message > div > img {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 120px;
  height: 90px;
  cursor: pointer;
}
#url-button {
  cursor: pointer;
  padding: 5px 15px;
  border: solid;
  border-radius: 3px;
  border-color: #999;
  border-width: thin;
  background-color: #DDD;
}
#url-input {
  width: calc(100% - 7em);
  margin: 0 1em;
}
#form-container {
  margin: 20px auto;
  width: 60vw;
  display: flex;
  margin-top: 20px;
  flex-direction: row;
  justify-content: center;
}
.remove-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 30px;
  height: 30px;
  text-align: center;
  font-size: 1.15em;
  color: #FFF;
  cursor: pointer;
  border-radius: 50%;
  background-color: #F07;
}
    </style>
  </head>
  <body>
    <div id="player-container">
      <div id="player-content" >
        <div id="ytplayer"></div>
      </div>
    </div>
    <div id="form-container">
      <input id="url-input" type="text" class="form-control" autocomplete="on">
      <div id="url-button" class="btn btn-primary" onclick="Go();">
        Go
      </div>
    </div>
    <div id="sub-container">
      <div id="message-container">
        <div id="message">
        </div>
      </div>
    </div>
    <script>
    var player;
    var youTubePlayerAPIReady = false;
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/player_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    var onYouTubePlayerAPIReady = function () {
      youTubePlayerAPIReady = true;
    };
    var addVideoId = function(videoId) {
      var videoIdList = getVideoIdList();
      videoIdList.push(videoId);
      setVideoIdList(videoIdList);
    };
    var removeVideoId = function(videoId) {
      var videoIdList = getVideoIdList();
      setVideoIdList(videoIdList.reduce(function(a, c){
        if(c != videoId) a.push(c);
        return a;
      }, []));
    };
    var getNextVideoId = function() {
      var nextVideoId = "";
      var videoIdList = getVideoIdList();
      if (videoIdList.length > 0) {
        nextVideoId = videoIdList[0];
        videoIdList.shift();
        setVideoIdList(videoIdList);
      }
      return nextVideoId;
    };
    var getVideoIdList = function() {
      var videoIdList = [];
      var jsonString = localStorage.getItem("videoIdList");
      if (!!jsonString && jsonString.length > 0) {
        videoIdList = JSON.parse(jsonString);
      }
      return videoIdList;
    };
    var setVideoIdList = function(videoIdList) {
      localStorage.setItem('videoIdList', JSON.stringify(videoIdList));
    };
    var getVideoIdFromUrl = function(url) {
      return url.split('?')[1].split('&')[0].split('=')[1];
    };
    var refreshMessage = function() {
      clearMessage();
      appendMessage(getVideoIdList());
    };
    var clearMessage = function() {
      document.getElementById("message").innerHTML = '';
    };
    var appendMessage = function(videoIdList) {
      var messageElement = document.getElementById("message");
      videoIdList.forEach(v => {
        var div = document.createElement("div");
        var img = document.createElement("img");
        img.src = "https://img.youtube.com/vi/".concat(v, "/default.jpg");
        div.append(img);
        div.id = v;
        div.onclick = function() {
          removeVideoId(v);
          refreshPlayer(v);
        };
        div.onmouseover = function() {
          mouseOver(v);
        };
        div.onmouseleave = function() {
          mouseLeave();
        }
        messageElement.append(div);
      });
    };
    var autoPlay = function() {
      if (!!player && !!player.getPlayerState && player.getPlayerState() == -1) {
        player.playVideo();
      }
      setTimeout(function() {
        autoPlay();
      }, 1000);
    };
    var Go = function() {
      var urlInput = document.getElementById("url-input");
      var videoId = getVideoIdFromUrl(urlInput.value);
      urlInput.value = "";
      if (!!player && !!player.getPlayerState && player.getPlayerState() == 1) {
        addVideoId(videoId);
        appendMessage([videoId]);
      } else {
        waitForAPIReady(videoId);
      }
    };
    var initPlayer = function(videoId) {
      player = new YT.Player('ytplayer', {
        height: '360',
        width: '640',
        videoId: videoId,
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange,
          'onError': onPlayerError,
        }
      });
    };
    var mouseOver = function(videoId) {
      var element = document.getElementById(videoId);
      if(element.lastElementChild.className == "remove-button") {
        return;
      }
      var div = document.createElement("div");
      div.className = "remove-button";
      div.innerHTML = '&times;';
      div.onclick = function(event) {
        event.stopPropagation();
        removeVideoId(videoId);
        refreshMessage();
      }
      element.append(div);
    };
    var mouseLeave = function(videoId) {
      document.getElementsByClassName("remove-button")[0].remove();
    };
    var refreshPlayer = function(nextVideoId) {
      if (nextVideoId.length > 0) {
        var contentElement = document.getElementById("player-content");
        contentElement.innerHTML = '';
        var divElement = document.createElement("div");
        divElement.id = 'ytplayer';
        contentElement.append(divElement);
        player = null;
        initPlayer(nextVideoId);
        refreshMessage();
      }
    }
    var onPlayerReady = function(event) {
      event.target.playVideo();
    }
    var onPlayerStateChange = function(event) {
      var ytStatus = event.data;
      if (ytStatus == YT.PlayerState.ENDED) {
        refreshPlayer(getNextVideoId());
      }
    }
    var onPlayerError = function(event) {
      console.log(event.data);
    }
    var waitForAPIReady = function(videoId) {
      if (youTubePlayerAPIReady) {
        refreshPlayer(videoId);
      } else {
        setTimeout(function() {
          waitForAPIReady(videoId);
        }, 1000);
      }
    };
    if (getVideoIdList().length > 0) {
      waitForAPIReady(getNextVideoId());
    }
    </script>
  </body>
</html>
